–¢—ã –æ–ø—ã—Ç–Ω—ã–π backend-—Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫ –Ω–∞ Python –∏ —ç–∫—Å–ø–µ—Ä—Ç –ø–æ Telegram-–±–æ—Ç–∞–º, FastAPI, APScheduler –∏ –∏–Ω—Ç–µ—Ä–≤–∞–ª—å–Ω—ã–º –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏—è–º (–≠–±–±–∏–Ω–≥–∞—É–∑ / spaced repetition).

–£ –º–µ–Ω—è –≥–æ—Ç–æ–≤—ã–π –ø—Ä–æ–µ–∫—Ç Telegram-–±–æ—Ç–∞ –¥–ª—è –æ–±—É—á–µ–Ω–∏—è –ø–æ –º–µ—Ç–æ–¥—É –≠–±–±–∏–Ω–≥–∞—É–∑–∞. –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–∏–º–µ—Ä–Ω–æ —Ç–∞–∫–∞—è:

app/
‚îú‚îÄ‚îÄ bot.py              # –û—Å–Ω–æ–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞ –±–æ—Ç–∞ (python-telegram-bot –∏–ª–∏ aiogram)
‚îú‚îÄ‚îÄ main.py             # FastAPI –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∏ HTTP-—ç–Ω–¥–ø–æ–∏–Ω—Ç—ã
‚îú‚îÄ‚îÄ config.py           # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (–≤ —Ç.—á. —Ç–∞–π–º–∑–æ–Ω–∞, –≤—Ä–µ–º—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π)
‚îú‚îÄ‚îÄ scheduler.py        # –ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ (APScheduler)
‚îú‚îÄ‚îÄ database/
‚îÇ   ‚îú‚îÄ‚îÄ models.py       # SQLAlchemy –º–æ–¥–µ–ª–∏
‚îÇ   ‚îú‚îÄ‚îÄ connection.py   # –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ PostgreSQL
‚îÇ   ‚îî‚îÄ‚îÄ migrations/     # Alembic –º–∏–≥—Ä–∞—Ü–∏–∏
‚îú‚îÄ‚îÄ services/
‚îÇ   ‚îú‚îÄ‚îÄ material_service.py      # –ú–∞—Ç–µ—Ä–∏–∞–ª—ã (–≤–æ–ø—Ä–æ—Å—ã)
‚îÇ   ‚îú‚îÄ‚îÄ schedule_service.py      # –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏–π
‚îÇ   ‚îú‚îÄ‚îÄ notification_service.py  # –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
‚îÇ   ‚îî‚îÄ‚îÄ user_service.py          # –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
‚îî‚îÄ‚îÄ utils/
    ‚îú‚îÄ‚îÄ ebbinghaus.py           # –õ–æ–≥–∏–∫–∞ –∏–Ω—Ç–µ—Ä–≤–∞–ª–æ–≤ –≠–±–±–∏–Ω–≥–∞—É–∑–∞
    ‚îî‚îÄ‚îÄ timezone_utils.py       # –†–∞–±–æ—Ç–∞ —Å —á–∞—Å–æ–≤—ã–º–∏ –ø–æ—è—Å–∞–º–∏

tests/
‚îú‚îÄ‚îÄ test_bot.py
‚îú‚îÄ‚îÄ test_services.py
‚îî‚îÄ‚îÄ test_utils.py

–¢–µ—Å—Ç—ã –∑–∞–ø—É—Å–∫–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ pytest, –≤ Docker –µ—Å—Ç—å –æ—Ç–¥–µ–ª—å–Ω—ã–π compose –¥–ª—è —Ç–µ—Å—Ç–æ–≤.

===================================
1. –ü—Ä–æ–±–ª–µ–º—ã, –∫–æ—Ç–æ—Ä—ã–µ –Ω—É–∂–Ω–æ –∏—Å–ø—Ä–∞–≤–∏—Ç—å
===================================

–ì–ª–∞–≤–Ω–æ–µ: –≤ —Å–∏—Å—Ç–µ–º–µ –∫–∞–∂–¥—ã–π –≤–æ–ø—Ä–æ—Å (material) —É–Ω–∏–∫–∞–ª—å–Ω—ã–π, –Ω–æ –ø—Ä–∏ –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏—è—Ö –≤—Å—ë –≤–µ–¥—ë—Ç —Å–µ–±—è –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ.

1) –í –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ –¥–Ω–∏ —É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –ø–æ–¥–±–æ—Ä–∫–µ –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏—è –ø–æ—è–≤–ª—è—é—Ç—Å—è –¥—É–±–ª–∏ –æ–¥–Ω–æ–≥–æ –∏ —Ç–æ–≥–æ –∂–µ –≤–æ–ø—Ä–æ—Å–∞, –≤ —Å–ª—É—á–∞–π–Ω–æ–º –ø–æ—Ä—è–¥–∫–µ. –Ø —Ö–æ—á—É, —á—Ç–æ–±—ã –∑–∞ –æ–¥–∏–Ω ¬´—Å–ª–æ—Ç¬ª –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏—è —Å–ø–∏—Å–æ–∫ –≤–æ–ø—Ä–æ—Å–æ–≤ –±—ã–ª —Å—Ç—Ä–æ–≥–æ –±–µ–∑ –¥—É–±–ª–µ–π. –î–ª—è –ø–∞—Ä—ã (user, material) –≤ –æ–¥–∏–Ω –º–æ–º–µ–Ω—Ç –≤—Ä–µ–º–µ–Ω–∏ –Ω–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ –∞–∫—Ç—É–∞–ª—å–Ω—ã—Ö ¬´–∑–∞–¥–∞–Ω–∏–π¬ª –Ω–∞ –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏–µ.

2) –õ–æ–≥–∏–∫–∞ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è –ø–æ –¥–Ω—è–º —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–µ–≤–µ—Ä–Ω–æ. –ù—É–∂–Ω–∞ –∂—ë—Å—Ç–∫–∞—è —Å—Ö–µ–º–∞ –∏–Ω—Ç–µ—Ä–≤–∞–ª–æ–≤, –ø—Ä–∏–≤—è–∑–∞–Ω–Ω–∞—è –∫ –º–æ–º–µ–Ω—Ç—É –ø–µ—Ä–≤–æ–π –∑–∞–ø–∏—Å–∏ –º–∞—Ç–µ—Ä–∏–∞–ª–∞, –∏ –≤ –∫–æ–Ω—Ü–µ ‚Äî —Ñ–∞–∑–∞ ¬´—Ä–∞–∑ –≤ –º–µ—Å—è—Ü¬ª:

   –í –¥–µ–Ω—å –∏–∑—É—á–µ–Ω–∏—è:
   1. –°—Ä–∞–∑—É (–º–æ–º–µ–Ω—Ç —Å–æ–∑–¥–∞–Ω–∏—è –º–∞—Ç–µ—Ä–∏–∞–ª–∞)
   2. –ß–µ—Ä–µ–∑ 20 –º–∏–Ω—É—Ç
   3. –í —ç—Ç–æ—Ç –∂–µ –¥–µ–Ω—å –≤ 20:00

   –î–∞–ª—å—à–µ:
   4. –ß–µ—Ä–µ–∑ 1 –¥–µ–Ω—å –≤ 07:00
   5. –ß–µ—Ä–µ–∑ 3 –¥–Ω—è –≤ 07:00
   6. –ß–µ—Ä–µ–∑ 7 –¥–Ω–µ–π –≤ 07:00
   7. –ß–µ—Ä–µ–∑ 14 –¥–Ω–µ–π –≤ 07:00
   8. –ß–µ—Ä–µ–∑ 30 –¥–Ω–µ–π –≤ 07:00

   –ü–æ—Å–ª–µ —ç—Ç–æ–≥–æ –≤–æ–ø—Ä–æ—Å –¥–æ–ª–∂–µ–Ω –ø–æ–≤—Ç–æ—Ä—è—Ç—å—Å—è **—Ä–∞–∑ –≤ –º–µ—Å—è—Ü** (–æ–¥–∏–Ω —Ä–∞–∑ –≤ –º–µ—Å—è—Ü –≤ 07:00, –ø–æ –≤—ã–±—Ä–∞–Ω–Ω–æ–π —Ç–æ–±–æ–π –ª–æ–≥–∏–∫–µ ‚Äî —Å–º. –Ω–∏–∂–µ).

–°–µ–π—á–∞—Å –∏–Ω—Ç–µ—Ä–≤–∞–ª—ã —Å—á–∏—Ç–∞—é—Ç—Å—è –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ: –≤–æ–ø—Ä–æ—Å—ã –º–æ–≥—É—Ç –ø—Ä–∏—Ö–æ–¥–∏—Ç—å –Ω–µ –ø–æ —ç—Ç–æ–º—É –≥—Ä–∞—Ñ–∏–∫—É –∏/–∏–ª–∏ —á–∞—â–µ, —á–µ–º –Ω—É–∂–Ω–æ –Ω–∞ ¬´–º–µ—Å—è—á–Ω–æ–π —Ñ–∞–∑–µ¬ª.

3) –°–æ–æ–±—â–µ–Ω–∏–µ –ø—Ä–∏ –Ω–µ—É–¥–∞—á–Ω–æ–º –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏–∏ —Å–µ–π—á–∞—Å —Ñ–æ—Ä–º—É–ª–∏—Ä—É–µ—Ç—Å—è –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ. –°–µ–π—á–∞—Å –±–æ—Ç –ø–∏—à–µ—Ç —á—Ç–æ-—Ç–æ –≤—Ä–æ–¥–µ:

   ‚ùå –ü–æ–≤—Ç–æ—Ä–µ–Ω–∏–µ –æ—Ç–º–µ—á–µ–Ω–æ –∫–∞–∫ –Ω–µ—É–¥–∞—á–Ω–æ–µ

   –ü—Ä–æ–¥–æ–ª–∂–∞–π –≤ —Ç–æ–º –∂–µ –¥—É—Ö–µ! üí™

–≠—Ç–æ –¥–µ–º–æ—Ç–∏–≤–∏—Ä—É—é—â–∏–π –∏ –ª–æ–≥–∏—á–µ—Å–∫–∏ –Ω–µ–≤–µ—Ä–Ω—ã–π —Ç–µ–∫—Å—Ç. –ù—É–∂–Ω–æ –∑–∞–º–µ–Ω–∏—Ç—å –Ω–∞ –∞–¥–µ–∫–≤–∞—Ç–Ω—É—é —Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–∫—É (—Å–º. –Ω–∏–∂–µ).

4) –ù—É–∂–µ–Ω HTTP-—ç–Ω–¥–ø–æ–∏–Ω—Ç –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è (—Ä—É—á–∫–∞), –∫–æ—Ç–æ—Ä—ã–π –ø–æ `user_id` –∏ `material_id` –ø–æ–∫–∞–∂–µ—Ç:
   - –∫–æ–≥–¥–∞ —É —ç—Ç–æ–≥–æ –º–∞—Ç–µ—Ä–∏–∞–ª–∞ —Å–ª–µ–¥—É—é—â–µ–µ –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏–µ,
   - –Ω–∞ –∫–∞–∫–æ–π —Å—Ç–∞–¥–∏–∏ –∏–Ω—Ç–µ—Ä–≤–∞–ª—å–Ω–æ–π —Ü–µ–ø–æ—á–∫–∏ –æ–Ω —Å–µ–π—á–∞—Å,
   - –∫—Ä–∞—Ç–∫—É—é –∏—Å—Ç–æ—Ä–∏—é –ø—Ä–æ—à–ª—ã—Ö –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏–π (—ç—Ç–∞–ø—ã, –¥–∞—Ç—ã, —Ä–µ–∑—É–ª—å—Ç–∞—Ç).

5) –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–µ –ø–æ –ø–æ–≤–µ–¥–µ–Ω–∏—é –Ω–∞ –∫–Ω–æ–ø–∫—É ¬´–ù–µ –ø–æ–≤—Ç–æ—Ä–∏–ª¬ª:
   - –í –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ –±–æ—Ç–∞ —É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –µ—Å—Ç—å –∫–Ω–æ–ø–∫–∞ ¬´–ù–µ –ø–æ–≤—Ç–æ—Ä–∏–ª¬ª (–∏–ª–∏ –∞–Ω–∞–ª–æ–≥–∏—á–Ω–∞—è –ø–æ —Å–º—ã—Å–ª—É).
   - –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∏–º–∞–µ—Ç —ç—Ç—É –∫–Ω–æ–ø–∫—É –¥–ª—è –∫–∞–∫–æ–≥–æ-—Ç–æ –≤–æ–ø—Ä–æ—Å–∞, —Ç–æ:
     **—ç—Ç–æ—Ç –≤–æ–ø—Ä–æ—Å –ø–µ—Ä–µ–Ω–æ—Å–∏—Ç—Å—è –Ω–∞ —Å–ª–µ–¥—É—é—â–∏–π –¥–µ–Ω—å –≤ 07:00 —É—Ç—Ä–∞** (–ø–æ —Ç–∞–π–º–∑–æ–Ω–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è / –±–æ—Ç–∞),
     –∏ **—Å—Ç–∞–¥–∏—è –æ—Ç–∫–∞—Ç—ã–≤–∞–µ—Ç—Å—è –Ω–∞–∑–∞–¥ –Ω–∞ –æ–¥–∏–Ω —à–∞–≥**, –Ω–æ –Ω–µ –Ω–∏–∂–µ 0.
   - –¢–æ –µ—Å—Ç—å:
     - `new_stage = max(0, current_stage - 1)`;
     - `next_due_at` = –∑–∞–≤—Ç—Ä–∞ –≤ 07:00 (–ª–æ–∫–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è);
     - –ø—Ä–∏ —ç—Ç–æ–º –≤–∞–∂–Ω–æ –Ω–µ —Å–æ–∑–¥–∞–≤–∞—Ç—å –≤—Ç–æ—Ä—É—é –∞–∫—Ç–∏–≤–Ω—É—é –∑–∞–ø–∏—Å—å –¥–ª—è —ç—Ç–æ–≥–æ –≤–æ–ø—Ä–æ—Å–∞.

===================================
2. –¢—Ä–µ–±—É–µ–º–∞—è –ª–æ–≥–∏–∫–∞ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è
===================================

–ü—É—Å—Ç—å `created_at` ‚Äî –≤—Ä–µ–º—è –ø–µ—Ä–≤–æ–≥–æ —Å–æ–∑–¥–∞–Ω–∏—è –º–∞—Ç–µ—Ä–∏–∞–ª–∞ (–ø–µ—Ä–≤—ã–π –≤–≤–æ–¥ –≤–æ–ø—Ä–æ—Å–∞ –≤ —Å–∏—Å—Ç–µ–º—É).

–ù—É–∂–Ω–∞ –µ–¥–∏–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è, –∫–æ—Ç–æ—Ä–∞—è —É–ø—Ä–∞–≤–ª—è–ª–∞ –±—ã –≤—Å–µ–º–∏ –∏–Ω—Ç–µ—Ä–≤–∞–ª–∞–º–∏.

–°–¥–µ–ª–∞–π (–∏–ª–∏ –¥–æ—Ä–∞–±–æ—Ç–∞–π) —Ñ—É–Ω–∫—Ü–∏—é –≤ `app/utils/ebbinghaus.py`:

`calculate_next_repetition(created_at: datetime, current_stage: int, timezone: tzinfo) -> tuple[datetime, int]`

- `current_stage` ‚Äî –Ω–æ–º–µ—Ä —Ç–µ–∫—É—â–µ–π —Å—Ç—É–ø–µ–Ω–∏:
  - 0 ‚Äî ¬´—Ç–æ–ª—å–∫–æ —á—Ç–æ —Å–æ–∑–¥–∞–Ω¬ª (–ø–µ—Ä–≤—ã–π –ø–æ–∫–∞–∑ –º–æ–∂–Ω–æ —Å—á–∏—Ç–∞—Ç—å —É–∂–µ —Å–æ—Å—Ç–æ—è–≤—à–∏–º—Å—è)
  - 1 ‚Äî +20 –º–∏–Ω—É—Ç
  - 2 ‚Äî —Å–µ–≥–æ–¥–Ω—è –≤ 20:00
  - 3 ‚Äî +1 –¥–µ–Ω—å, 07:00
  - 4 ‚Äî +3 –¥–Ω—è, 07:00
  - 5 ‚Äî +7 –¥–Ω–µ–π, 07:00
  - 6 ‚Äî +14 –¥–Ω–µ–π, 07:00
  - 7 ‚Äî +30 –¥–Ω–µ–π, 07:00
  - 8 –∏ –¥–∞–ª–µ–µ ‚Äî ¬´–º–µ—Å—è—á–Ω–∞—è —Ñ–∞–∑–∞¬ª

–¢—Ä–µ–±—É–µ—Ç—Å—è:

1) –î–ª—è —Å—Ç–∞–¥–∏–π 0‚Äì7:
   - –í–µ—Ä–Ω–æ —Å—á–∏—Ç–∞—Ç—å `next_due_at` –≤ —É–∫–∞–∑–∞–Ω–Ω–æ–π —Ç–∞–π–º–∑–æ–Ω–µ (–∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `timezone_utils.py` –∏/–∏–ª–∏ `DEFAULT_TIMEZONE` –∏–∑ `config.py`).
   - –î–ª—è ¬´—Å–µ–≥–æ–¥–Ω—è –≤ 20:00¬ª –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç—É –∂–µ –¥–∞—Ç—É, —á—Ç–æ —É `created_at`, –Ω–æ –≤—Ä–µ–º—è –≤—ã—Å—Ç–∞–≤–∏—Ç—å 20:00 –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏.
   - –î–ª—è 07:00 ‚Äî –¥–∞—Ç–∞ = `created_at.date() + N –¥–Ω–µ–π`, –≤—Ä–µ–º—è = 07:00 –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏.

2) –î–ª—è —Å—Ç–∞–¥–∏–π 8+ (–º–µ—Å—è—á–Ω–∞—è —Ñ–∞–∑–∞):

   - –ü–æ—Å–ª–µ —Ç–æ–≥–æ –∫–∞–∫ –≤–æ–ø—Ä–æ—Å –¥–æ—à—ë–ª –¥–æ —Å—Ç–∞–¥–∏–∏ 7 (–∏–Ω—Ç–µ—Ä–≤–∞–ª 30 –¥–Ω–µ–π) –∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É—Å–ø–µ—à–Ω–æ –µ—ë –ø—Ä–æ—à—ë–ª,
     –≤—Å–µ –ø–æ—Å–ª–µ–¥—É—é—â–∏–µ **—É—Å–ø–µ—à–Ω—ã–µ** –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏—è (—Å—Ç–∞–¥–∏—è ‚â• 8) —Ä–∞–±–æ—Ç–∞—é—Ç –ø–æ —Å—Ö–µ–º–µ:

       next_due_at = last_success_at + 30 –¥–Ω–µ–π (–≤ 07:00 –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏)

   - –¢–æ –µ—Å—Ç—å –∫–∞–∂–¥–∞—è —Å–ª–µ–¥—É—é—â–∞—è —É—Å–ø–µ—à–Ω–∞—è —Ä–µ–ø–µ—Ç–∏—Ü–∏—è –Ω–∞ –º–µ—Å—è—á–Ω–æ–π —Ñ–∞–∑–µ –≤—Å–µ–≥–¥–∞ —Å–¥–≤–∏–≥–∞–µ—Ç –¥–∞—Ç—É
     —Ä–æ–≤–Ω–æ –Ω–∞ 30 –¥–Ω–µ–π –≤–ø–µ—Ä—ë–¥, –≤—Ä–µ–º—è —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ ‚Äî 07:00.

   - –°—Ç–∞–¥–∏—é –º–æ–∂–Ω–æ –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞—Ç—å, –Ω–∞–ø—Ä–∏–º–µ—Ä, –∫–∞–∫ 8 (–∏ –±–æ–ª—å—à–µ –µ—ë –Ω–µ —É–≤–µ–ª–∏—á–∏–≤–∞—Ç—å),
     –ª–∏–±–æ –ø—Ä–æ–¥–æ–ª–∂–∞—Ç—å –∏–Ω–∫—Ä–µ–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å, –Ω–æ —ç—Ç–æ **–Ω–µ –¥–æ–ª–∂–Ω–æ –º–µ–Ω—è—Ç—å –∏–Ω—Ç–µ—Ä–≤–∞–ª**:
     –∏–Ω—Ç–µ—Ä–≤–∞–ª –æ—Å—Ç–∞—ë—Ç—Å—è —Å—Ç–∞–±–∏–ª—å–Ω—ã–º ‚Äî 30 –¥–Ω–µ–π.

   - –ì–ª–∞–≤–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è:
     - –∏–Ω—Ç–µ—Ä–≤–∞–ª –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –∫–æ—Ä–æ—á–µ 30 –¥–Ω–µ–π –∏–∑-–∑–∞ —É—Å–ø–µ—à–Ω–æ–≥–æ –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏—è;
     - –ø–µ—Ä–µ—Ö–æ–¥ –Ω–∞ –±–æ–ª–µ–µ —á–∞—Å—Ç—ã–µ –∏–Ω—Ç–µ—Ä–≤–∞–ª—ã –≤–æ–∑–º–æ–∂–µ–Ω **—Ç–æ–ª—å–∫–æ** –ø—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º
       –∫–Ω–æ–ø–∫–∏ ¬´–ù–µ –ø–æ–≤—Ç–æ—Ä–∏–ª¬ª (—Å–º. —Ä–∞–∑–¥–µ–ª –ø—Ä–æ –Ω–µ—É—Å–ø–µ—à–Ω–æ–µ –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏–µ);
     - –Ω–∏–∫–∞–∫–æ–≥–æ ¬´—Å–±—Ä–æ—Å–∞¬ª –æ–±—Ä–∞—Ç–Ω–æ –Ω–∞ 7 –¥–Ω–µ–π, 3 –¥–Ω—è –∏ —Ç.–ø. –ø—Ä–∏ —É—Å–ø–µ—Ö–µ.


3) –§—É–Ω–∫—Ü–∏—è –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å —á–∏—Å—Ç–æ–π (pure): –Ω–µ —Ö–æ–¥–∏—Ç—å –≤ –ë–î, –Ω–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≥–ª–æ–±–∞–ª—å–Ω–æ–µ ¬´—Å–µ–π—á–∞—Å¬ª ‚Äî –≤—Å—ë, —á—Ç–æ –Ω—É–∂–Ω–æ, –µ–π –ø–µ—Ä–µ–¥–∞—ë—Ç—Å—è –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏.

–≠—Ç–∞ —Ñ—É–Ω–∫—Ü–∏—è –±—É–¥–µ—Ç —Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–º –∏—Å—Ç–æ—á–Ω–∏–∫–æ–º –ø—Ä–∞–≤–¥—ã –¥–ª—è `schedule_service.py` –∏ `scheduler.py`.

===================================
3. –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –¥—É–±–ª–µ–π –≤–æ–ø—Ä–æ—Å–æ–≤
===================================

–°–µ–π—á–∞—Å –≥–¥–µ-—Ç–æ –≤ —Å–≤—è–∑–∫–µ `schedule_service.py` + `scheduler.py` + –º–æ–¥–µ–ª–∏ –ë–î –≤–æ–∑–Ω–∏–∫–∞–µ—Ç —Å–∏—Ç—É–∞—Ü–∏—è, –∫–æ–≥–¥–∞ –¥–ª—è –æ–¥–Ω–æ–π –ø–∞—Ä—ã (user, material) –º–æ–∂–µ—Ç —Å—É—â–µ—Å—Ç–≤–æ–≤–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –∞–∫—Ç–∏–≤–Ω—ã—Ö –∑–∞–ø–∏—Å–µ–π –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏—è.

–ó–∞–¥–∞—á–∞:

1) –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –º–æ–¥–µ–ª–∏ –≤ `app/database/models.py`:
   - –∫–∞–∫ —Ö—Ä–∞–Ω—è—Ç—Å—è –º–∞—Ç–µ—Ä–∏–∞–ª—ã (`Material` –∏–ª–∏ –∞–Ω–∞–ª–æ–≥),
   - –∫–∞–∫ —Ö—Ä–∞–Ω—è—Ç—Å—è —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è/–ø–æ–≤—Ç–æ—Ä–µ–Ω–∏—è (–Ω–∞–ø—Ä–∏–º–µ—Ä, `Schedule`, `Repetition`, `MaterialSchedule` ‚Äî –ø–æ—Å–º–æ—Ç—Ä–∏ —Ä–µ–∞–ª—å–Ω—ã–µ –∏–º–µ–Ω–∞).

2) –í `schedule_service.py` –∏/–∏–ª–∏ `notification_service.py` –Ω–∞–π—Ç–∏ –∫–æ–¥, –∫–æ—Ç–æ—Ä—ã–π:
   - —Å–æ–∑–¥–∞—ë—Ç –∑–∞–ø–∏—Å–∏ –≤ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–∏ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –º–∞—Ç–µ—Ä–∏–∞–ª–∞;
   - –æ–±–Ω–æ–≤–ª—è–µ—Ç —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ –ø–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏—è (—É—Å–ø–µ—Ö/–Ω–µ—É—Å–ø–µ—Ö);
   - –≤—ã–±–∏—Ä–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏–π ¬´–Ω–∞ —Å–µ–π—á–∞—Å¬ª –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

3) –û–±–µ—Å–ø–µ—á–∏—Ç—å –∏–Ω–≤–∞—Ä–∏–∞–Ω—Ç:
   - –¥–ª—è –∫–∞–∂–¥–æ–π –ø–∞—Ä—ã `(user_id, material_id)` –≤ –ª—é–±–æ–π –º–æ–º–µ–Ω—Ç –≤—Ä–µ–º–µ–Ω–∏ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –Ω–µ –±–æ–ª–µ–µ –æ–¥–Ω–æ–π –∑–∞–ø–∏—Å–∏, –∫–æ—Ç–æ—Ä–∞—è —Å—á–∏—Ç–∞–µ—Ç—Å—è ¬´–∞–∫—Ç–∏–≤–Ω—ã–º¬ª —Å–ª–µ–¥—É—é—â–∏–º –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏–µ–º;
   - –ø—Ä–∏ –≤—ã–±–æ—Ä–µ ¬´–≤–æ–ø—Ä–æ—Å–æ–≤ –Ω–∞ —Å–µ–≥–æ–¥–Ω—è¬ª –¥–æ–ª–∂–µ–Ω –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å—Å—è —Å–ø–∏—Å–æ–∫ –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤ –±–µ–∑ –¥—É–±–ª–µ–π –ø–æ `material_id`.

–†–µ–∞–ª–∏–∑–∞—Ü–∏—è (–ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ):

- –ù–∞ —É—Ä–æ–≤–Ω–µ SQLAlchemy:
  - –¥–æ–±–∞–≤–∏—Ç—å —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–Ω–¥–µ–∫—Å / `UniqueConstraint` –Ω–∞ `(user_id, material_id, status)` –¥–ª—è —Å—Ç–∞—Ç—É—Å–∞ ¬´PLANNED¬ª –∏–ª–∏ –∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ–≥–æ;
  - –ø—Ä–∏ –ø–æ–ø—ã—Ç–∫–µ —Å–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é –∑–∞–ø–∏—Å—å ‚Äî –æ–±–Ω–æ–≤–ª—è—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é, –∞ –Ω–µ –ø–ª–æ–¥–∏—Ç—å –¥—É–±–ª–∏–∫–∞—Ç—ã.

- –ù–∞ —É—Ä–æ–≤–Ω–µ Python:
  - –≤ —Ñ—É–Ω–∫—Ü–∏–∏, –∫–æ—Ç–æ—Ä–∞—è –≤—ã—Ç–∞—Å–∫–∏–≤–∞–µ—Ç —Å–ø–∏—Å–æ–∫ ¬´due¬ª –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏–π, —è–≤–Ω–æ —Å–¥–µ–ª–∞—Ç—å –∑–∞—â–∏—Ç—É –æ—Ç –¥—É–±–ª–µ–π: –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∞—Ç—å –ø–æ `material_id` –∏ –±—Ä–∞—Ç—å —Ç–æ–ª—å–∫–æ –æ–¥–Ω—É –∑–∞–ø–∏—Å—å –Ω–∞ –º–∞—Ç–µ—Ä–∏–∞–ª.

–ù—É–∂–Ω–æ, —á—Ç–æ–±—ã:
- –¥—É–±–ª–∏ –ø–µ—Ä–µ—Å—Ç–∞–ª–∏ –≤–æ–∑–Ω–∏–∫–∞—Ç—å –≤ –ë–î;
- –¥–∞–∂–µ –µ—Å–ª–∏ –ë–î —É–∂–µ —Å–æ–¥–µ—Ä–∂–∏—Ç –¥—É–±–ª—å, –∫–æ–¥ –ø—Ä–∏ –≤—ã–±–æ—Ä–∫–µ –Ω–µ –≤–æ–∑–≤—Ä–∞—â–∞–ª –Ω–µ—Å–∫–æ–ª—å–∫–æ –æ–¥–∏–Ω–∞–∫–æ–≤—ã—Ö –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤.

===================================
4. –ü–æ–≤–µ–¥–µ–Ω–∏–µ –ø—Ä–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–µ –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏—è
===================================

1) **–£—Å–ø–µ—à–Ω–æ–µ –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏–µ** (–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ¬´—É—Å–ø–µ–ª¬ª/–æ—Ç–º–µ—Ç–∏–ª –∫–∞–∫ –Ω–æ—Ä–º–∞–ª—å–Ω–æ–µ):
   - —Å—Ç–∞–¥–∏—è —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç—Å—è —Å–æ–≥–ª–∞—Å–Ω–æ —Ü–µ–ø–æ—á–∫–µ (0‚Üí1‚Üí2‚Üí‚Ä¶‚Üí7‚Üí8);
   - `next_due_at` —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ `calculate_next_repetition(created_at, current_stage, timezone)`.

2) **–ù–µ—É—Å–ø–µ—à–Ω–æ–µ –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏–µ** (–∫–Ω–æ–ø–∫–∞ ¬´–ù–µ –ø–æ–≤—Ç–æ—Ä–∏–ª¬ª):
   - —Å—Ç–∞–¥–∏—è –æ—Ç–∫–∞—Ç—ã–≤–∞–µ—Ç—Å—è –Ω–∞ –æ–¥–Ω—É —Å—Ç—É–ø–µ–Ω—å –Ω–∞–∑–∞–¥:
     - `new_stage = max(0, current_stage - 1)`;
   - `next_due_at` —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –Ω–∞ **—Å–ª–µ–¥—É—é—â–∏–π –∫–∞–ª–µ–Ω–¥–∞—Ä–Ω—ã–π –¥–µ–Ω—å –≤ 07:00** –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è/–±–æ—Ç–∞ (–∏—Å–ø–æ–ª—å–∑—É–π `failed_at.date() + 1 –¥–µ–Ω—å` –∏ 07:00);
   - –µ—Å–ª–∏ –≤–æ–ø—Ä–æ—Å –±—ã–ª –Ω–∞ –º–µ—Å—è—á–Ω–æ–π —Ñ–∞–∑–µ (—Å—Ç–∞–¥–∏—è ‚â• 8), –ø—Ä–∏ –Ω–µ—É—Å–ø–µ—à–Ω–æ–º –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏–∏:
     - —Å—Ç–∞–¥–∏—è –≤—Å—ë —Ä–∞–≤–Ω–æ –æ—Ç–∫–∞—Ç—ã–≤–∞–µ—Ç—Å—è: `new_stage = max(0, current_stage - 1)`,
     - –∏ –¥–∞—Ç–∞ —Å–ª–µ–¥—É—é—â–µ–≥–æ –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏—è = –∑–∞–≤—Ç—Ä–∞ –≤ 07:00;
   - –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è –Ω–µ —Å–æ–∑–¥–∞—ë—Ç—Å—è –Ω–æ–≤–∞—è –∞–∫—Ç–∏–≤–Ω–∞—è –∑–∞–ø–∏—Å—å ‚Äî –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∞—è –∑–∞–ø–∏—Å—å –¥–ª—è `(user_id, material_id)`.

3) **–¢–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è –ø—Ä–∏ –Ω–µ—É—Å–ø–µ—à–Ω–æ–º –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏–∏**:

–ù—É–∂–Ω–æ –∑–∞–º–µ–Ω–∏—Ç—å —Ç–µ–∫—É—â—É—é –≤–µ—Ä—Å–∏—é –Ω–∞:

‚ùå –ü–æ–≤—Ç–æ—Ä–µ–Ω–∏–µ –æ—Ç–º–µ—á–µ–Ω–æ –∫–∞–∫ –Ω–µ—É—Å–ø–µ—à–Ω–æ–µ.

–ù–∏—á–µ–≥–æ —Å—Ç—Ä–∞—à–Ω–æ–≥–æ: –ø–æ–ø—Ä–æ–±—É–π –ø–æ–≤—Ç–æ—Ä—è—Ç—å –º–∞—Ç–µ—Ä–∏–∞–ª –ø–æ—á–∞—â–µ, —á—Ç–æ–±—ã —É—Å–ø–µ–≤–∞—Ç—å –ø–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—é –≠–±–±–∏–Ω–≥–∞—É–∑–∞ üí™

–ù–∞–π–¥–∏ –º–µ—Å—Ç–æ –≤ `bot.py` –∏–ª–∏ –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–µ–º —Å–µ—Ä–≤–∏—Å–Ω–æ–º —Å–ª–æ–µ, –≥–¥–µ —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç—Å—è —ç—Ç–æ —Å–æ–æ–±—â–µ–Ω–∏–µ, –∏ –∑–∞–º–µ–Ω–∏ —Ç–µ–∫—Å—Ç, –Ω–µ –ª–æ–º–∞—è –æ—Å—Ç–∞–ª—å–Ω—É—é –ª–æ–≥–∏–∫—É.

===================================
5. Debug-—ç–Ω–¥–ø–æ–∏–Ω—Ç –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è
===================================

–í `app/main.py` –∏–ª–∏ –≤ –º–æ–¥—É–ª–µ —Å API-—Ä–æ—É—Ç–∞–º–∏ –¥–æ–±–∞–≤—å –Ω–æ–≤—ã–π GET-—ç–Ω–¥–ø–æ–∏–Ω—Ç.

–ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ –ø–æ URL (–º–æ–∂–µ—à—å –∞–¥–∞–ø—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ–¥ —Ç–µ–∫—É—â–∏–π —Å—Ç–∏–ª—å):

`GET /api/users/{user_id}/materials/{material_id}/debug-schedule`

–ü–∞—Ä–∞–º–µ—Ç—Ä—ã: `user_id`, `material_id` (–∏–∑ path).

–û—Ç–≤–µ—Ç JSON (–æ–±—â–∞—è –∏–¥–µ—è, –∞–¥–∞–ø—Ç–∏—Ä—É–π –ø–æ–¥ —Ä–µ–∞–ª—å–Ω—ã–µ –º–æ–¥–µ–ª–∏):

{
  "user_id": 123,
  "material_id": 456,
  "material_text": "–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –ø–∞–º—è—Ç—å –≤ Python?",
  "created_at": "2025-12-01T10:00:00+03:00",
  "current_stage": 5,
  "next_due_at": "2025-12-08T07:00:00+03:00",
  "timezone": "Europe/Moscow",
  "history": [
    {
      "stage": 0,
      "planned_at": "2025-12-01T10:00:00+03:00",
      "done_at": "2025-12-01T10:00:05+03:00",
      "result": "success"
    },
    {
      "stage": 1,
      "planned_at": "2025-12-01T10:20:00+03:00",
      "done_at": "2025-12-01T10:20:15+03:00",
      "result": "success"
    }
    ...
  ]
}

–í–∞–∂–Ω–æ:
- –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Å–µ—Ä–≤–∏—Å—ã: `material_service`, `schedule_service`, `timezone_utils`;
- –Ω–µ –¥–µ–ª–∞—Ç—å –º–æ–∫–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö: —ç–Ω–¥–ø–æ–∏–Ω—Ç —Ä–µ–∞–ª—å–Ω–æ —á–∏—Ç–∞–µ—Ç –∏–∑ –ë–î;
- –ø—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è/–º–∞—Ç–µ—Ä–∏–∞–ª–∞ –≤–µ—Ä–Ω—É—Ç—å –ø–æ–Ω—è—Ç–Ω—É—é 404 —Å JSON.

===================================
6. Unit-—Ç–µ—Å—Ç—ã, –∫–æ—Ç–æ—Ä—ã–µ –Ω—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å/–æ–±–Ω–æ–≤–∏—Ç—å
===================================

–§—Ä–µ–π–º–≤–æ—Ä–∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è ‚Äî pytest. –¢–µ—Å—Ç—ã —É–∂–µ —Ä–∞–∑–±–∏—Ç—ã –ø–æ —Ñ–∞–π–ª–∞–º:

- `tests/test_bot.py`
- `tests/test_services.py`
- `tests/test_utils.py`

–ù—É–∂–Ω–æ:

1) **–¢–µ—Å—Ç—ã –¥–ª—è `utils/ebbinghaus.py`**  
   –§–∞–π–ª: `tests/test_utils.py`

   –ù–∞–ø–∏—Å–∞—Ç—å –Ω–∞–±–æ—Ä —Ç–µ—Å—Ç–æ–≤ –¥–ª—è `calculate_next_repetition`:

   - –î–ª—è —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ `created_at` –∏ —Ñ–∏–∫—Ç–∏–≤–Ω–æ–π —Ç–∞–π–º–∑–æ–Ω—ã –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –≤—Å–µ —Å—Ç–∞–¥–∏–∏ 0‚Äì7:
     - 0 ‚Üí 1 (–ª–æ–≥–∏–∫–∞ –ø–µ—Ä–≤–æ–≥–æ –ø–æ–∫–∞–∑–∞ / —Å—Ä–∞–∑—É)
     - 1 ‚Üí 2 (+20 –º–∏–Ω—É—Ç)
     - 2 ‚Üí 3 (—Å–µ–≥–æ–¥–Ω—è –≤ 20:00)
     - 3 ‚Üí 4 (+1 –¥–µ–Ω—å, 07:00)
     - 4 ‚Üí 5 (+3 –¥–Ω—è, 07:00)
     - 5 ‚Üí 6 (+7 –¥–Ω–µ–π, 07:00)
     - 6 ‚Üí 7 (+14 –¥–Ω–µ–π, 07:00)
     - 7 ‚Üí 8 (+30 –¥–Ω–µ–π, 07:00)
   - –î–ª—è —Å—Ç–∞–¥–∏–∏ 8+:
     - –ø—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ `next_due_at` —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç ¬´—Ä–∞–∑ –≤ –º–µ—Å—è—Ü¬ª –ø–æ –≤—ã–±—Ä–∞–Ω–Ω–æ–π —Å—Ö–µ–º–µ, –∏ —Å—Ç–∞–¥–∏—è –Ω–µ –æ—Ç–∫–∞—Ç—ã–≤–∞–µ—Ç—Å—è –Ω–∞–∑–∞–¥ –∏–∑-–∑–∞ —Å–∞–º–æ–π —Ñ—É–Ω–∫—Ü–∏–∏.

2) **–¢–µ—Å—Ç—ã –Ω–∞ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –¥—É–±–ª–µ–π –≤–æ–ø—Ä–æ—Å–æ–≤**  
   –§–∞–π–ª: `tests/test_services.py`

   - –ß–µ—Ä–µ–∑ —Ñ–∏–∫—Å—Ç—É—Ä—ã —Å–æ–∑–¥–∞—Ç—å:
     - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è;
     - –Ω–µ—Å–∫–æ–ª—å–∫–æ –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤;
     - –¥–ª—è –æ–¥–Ω–æ–≥–æ –º–∞—Ç–µ—Ä–∏–∞–ª–∞ ‚Äî –¥–≤–µ –∑–∞–ø–∏—Å–∏ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è –≤ —Å—Ç–∞—Ç—É—Å–µ ¬´PLANNED¬ª.
   - –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å `schedule_service.get_due_materials_for_user(...)` (–∏–ª–∏ –∞–Ω–∞–ª–æ–≥):
     - –≤ –≤–æ–∑–≤—Ä–∞—â–∞–µ–º–æ–º —Å–ø–∏—Å–∫–µ –∫–∞–∂–¥—ã–π `material_id` –≤—Å—Ç—Ä–µ—á–∞–µ—Ç—Å—è –º–∞–∫—Å–∏–º—É–º –æ–¥–∏–Ω —Ä–∞–∑.
   - –û—Ç–¥–µ–ª—å–Ω—ã–π —Ç–µ—Å—Ç: –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏/–æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è –Ω–µ –ø–æ—è–≤–ª—è—é—Ç—Å—è –Ω–æ–≤—ã–µ –¥—É–±–ª–∏ ‚Äî –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–∞–ø–∏—Å–∏.

3) **–¢–µ—Å—Ç—ã ¬´–º–µ—Å—è—á–Ω–æ–π —Ñ–∞–∑—ã¬ª**  
   –§–∞–π–ª: `tests/test_utils.py`

   - –°–º–æ–¥–µ–ª–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏–µ –≤—Å–µ—Ö —Å—Ç—É–ø–µ–Ω–µ–π –¥–æ 30 –¥–Ω–µ–π;
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –¥–∞–ª—å–Ω–µ–π—à–∏–µ –≤—ã–∑–æ–≤—ã —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è —É—Å–ø–µ—à–Ω—ã—Ö –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏–π –¥–µ–ª–∞—é—Ç –∏–Ω—Ç–µ—Ä–≤–∞–ª—ã –Ω–µ –º–µ–Ω—å—à–µ –º–µ—Å—è—Ü–∞.

4) **–¢–µ—Å—Ç—ã —Ç–µ–∫—Å—Ç–∞ –ø—Ä–∏ –Ω–µ—É—Å–ø–µ—à–Ω–æ–º –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏–∏**  
   –§–∞–π–ª: `tests/test_bot.py`

   - –°–º–æ–¥–µ–ª–∏—Ä–æ–≤–∞—Ç—å callback/–∫–æ–º–∞–Ω–¥—É, –æ–∑–Ω–∞—á–∞—é—â—É—é ¬´–ù–µ –ø–æ–≤—Ç–æ—Ä–∏–ª¬ª;
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ —Ç–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è:
     - —Å–æ–¥–µ—Ä–∂–∏—Ç —Å—Ç—Ä–æ–∫—É ¬´–ü–æ–≤—Ç–æ—Ä–µ–Ω–∏–µ –æ—Ç–º–µ—á–µ–Ω–æ –∫–∞–∫ –Ω–µ—É—Å–ø–µ—à–Ω–æ–µ.¬ª;
     - —Å–æ–¥–µ—Ä–∂–∏—Ç —Å–æ–≤–µ—Ç –≤ –¥—É—Ö–µ ¬´–ø–æ–ø—Ä–æ–±—É–π –ø–æ–≤—Ç–æ—Ä—è—Ç—å –º–∞—Ç–µ—Ä–∏–∞–ª –ø–æ—á–∞—â–µ, —á—Ç–æ–±—ã —É—Å–ø–µ–≤–∞—Ç—å –ø–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—é –≠–±–±–∏–Ω–≥–∞—É–∑–∞¬ª.

5) **–¢–µ—Å—Ç—ã –ø–æ–≤–µ–¥–µ–Ω–∏—è –ø—Ä–∏ –∫–Ω–æ–ø–∫–µ ¬´–ù–µ –ø–æ–≤—Ç–æ—Ä–∏–ª¬ª**  
   –§–∞–π–ª: `tests/test_services.py` (–∏/–∏–ª–∏ `test_bot.py`)

   –ù—É–∂–Ω—ã –∫–∞–∫ –º–∏–Ω–∏–º—É–º –¥–≤–∞ —É—Ä–æ–≤–Ω—è:

   a) –°–µ—Ä–≤–∏—Å–Ω—ã–π —É—Ä–æ–≤–µ–Ω—å (`schedule_service`):
      - –î–∞–Ω–æ: –º–∞—Ç–µ—Ä–∏–∞–ª –Ω–∞ —Å—Ç–∞–¥–∏–∏ `current_stage = k` (–Ω–∞–ø—Ä–∏–º–µ—Ä, 5), –µ—Å—Ç—å –∞–∫—Ç–∏–≤–Ω–∞—è –∑–∞–ø–∏—Å—å —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è.
      - –ö–æ–≥–¥–∞: –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –º–µ—Ç–æ–¥, –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—â–∏–π ¬´–ù–µ –ø–æ–≤—Ç–æ—Ä–∏–ª¬ª (–Ω–∞–ø—Ä–∏–º–µ—Ä, `schedule_service.mark_failed(user_id, material_id, failed_at)`).
      - –¢–æ–≥–¥–∞:
        - `new_stage = max(0, k - 1)`;
        - `next_due_at = (failed_at.date() + 1 –¥–µ–Ω—å, 07:00)` –≤ –ª–æ–∫–∞–ª—å–Ω–æ–π —Ç–∞–π–º–∑–æ–Ω–µ;
        - –≤ –ë–î –ø–æ-–ø—Ä–µ–∂–Ω–µ–º—É —Ç–æ–ª—å–∫–æ –æ–¥–Ω–∞ –∞–∫—Ç–∏–≤–Ω–∞—è –∑–∞–ø–∏—Å—å –¥–ª—è `(user_id, material_id)`.

      - –û—Ç–¥–µ–ª—å–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–≤–µ–¥–µ–Ω–∏–µ –¥–ª—è:
        - `current_stage = 0` (—Å—Ç–∞–¥–∏—è –Ω–µ —É—Ö–æ–¥–∏—Ç –≤ -1, –æ—Å—Ç–∞—ë—Ç—Å—è 0);
        - `current_stage >= 8` (–º–µ—Å—è—á–Ω–∞—è —Ñ–∞–∑–∞) ‚Äî —Å—Ç–∞–¥–∏—è —É–º–µ–Ω—å—à–∞–µ—Ç—Å—è –Ω–∞ 1, –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏–µ –ø–µ—Ä–µ–Ω–æ—Å–∏—Ç—Å—è –Ω–∞ –∑–∞–≤—Ç—Ä–∞ –≤ 07:00.

   b) –ë–æ—Ç–æ–≤—ã–π —É—Ä–æ–≤–µ–Ω—å (`bot`):
      - –î–∞–Ω–æ: callback-–∫–Ω–æ–ø–∫–∞ ¬´–ù–µ –ø–æ–≤—Ç–æ—Ä–∏–ª¬ª –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –º–∞—Ç–µ—Ä–∏–∞–ª–∞.
      - –ö–æ–≥–¥–∞: –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è handler.
      - –¢–æ–≥–¥–∞:
        - –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –Ω—É–∂–Ω—ã–π –º–µ—Ç–æ–¥ —Å–µ—Ä–≤–∏—Å–∞ –¥–ª—è –ø–µ—Ä–µ–Ω–æ—Å–∞ –Ω–∞ –∑–∞–≤—Ç—Ä–∞ –∏ –æ—Ç–∫–∞—Ç–∞ —Å—Ç–∞–¥–∏–∏;
        - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π —Ç–µ–∫—Å—Ç –∏–∑ –ø—É–Ω–∫—Ç–∞ 4;
        - –≤ –æ—Ç–≤–µ—Ç–µ –Ω–µ—Ç –¥—É–±–ª–µ–π —ç—Ç–æ–≥–æ –∂–µ –≤–æ–ø—Ä–æ—Å–∞ –Ω–∞ —Ç–µ–∫—É—â–∏–π –º–æ–º–µ–Ω—Ç.

6) **–¢–µ—Å—Ç—ã –¥–ª—è debug-—ç–Ω–¥–ø–æ–∏–Ω—Ç–∞**  
   –§–∞–π–ª: `tests/test_services.py` –∏–ª–∏ `tests/test_api_debug.py`

   - –ü–æ–∑–∏—Ç–∏–≤–Ω—ã–π –∫–µ–π—Å:
     - —Å–æ–∑–¥–∞—Ç—å –≤ –ë–î –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –º–∞—Ç–µ—Ä–∏–∞–ª, –∏—Å—Ç–æ—Ä–∏—é –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏–π;
     - –≤—ã–∑–≤–∞—Ç—å `GET /api/users/{user_id}/materials/{material_id}/debug-schedule`;
     - –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–¥ 200 –∏ –Ω–∞–ª–∏—á–∏–µ –ø–æ–ª–µ–π: `user_id`, `material_id`, `created_at`, `current_stage`, `next_due_at`, `history`.
   - –ù–µ–≥–∞—Ç–∏–≤–Ω—ã–µ –∫–µ–π—Å—ã:
     - –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π `material_id` –∏–ª–∏ `user_id` ‚Üí 404 —Å –ø–æ–Ω—è—Ç–Ω—ã–º json.

===================================
7. –û–±—â–∏–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ –∏–∑–º–µ–Ω–µ–Ω–∏—è–º
===================================

1) –ù–∏–∫–∞–∫–∏—Ö –∑–∞–≥–ª—É—à–µ–∫: –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–π –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –≤–∏–¥–∞ ¬´# TODO¬ª, ¬´# your code here¬ª. –ù—É–∂–µ–Ω –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ä–∞–±–æ—á–∏–π –∫–æ–¥, –∫–æ—Ç–æ—Ä—ã–π –∫–æ–º–ø–∏–ª–∏—Ä—É–µ—Ç—Å—è –∏ –ø—Ä–æ—Ö–æ–¥–∏—Ç —Ç–µ—Å—Ç—ã.

2) –ü–æ–¥—Å—Ç—Ä–æ–π—Å—è –ø–æ–¥ —Ç–µ–∫—É—â—É—é –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É:
   - —Å–æ—Ö—Ä–∞–Ω–∏ —Å—Ç–∏–ª—å –∫–æ–¥–∞ (type hints, pydantic-—Å—Ö–µ–º—ã, —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ);
   - –∏—Å–ø–æ–ª—å–∑—É–π —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Å–µ—Ä–≤–∏—Å—ã –∏ —É—Ç–∏–ª–∏—Ç—ã (`material_service`, `schedule_service`, `timezone_utils`, `notification_service`).

3) –ü–µ—Ä–µ–¥ —Ç–µ–º, –∫–∞–∫ –ø–æ–∫–∞–∑–∞—Ç—å —Ñ–∏–Ω–∞–ª—å–Ω—ã–π –∫–æ–¥, –∫—Ä–∞—Ç–∫–æ –æ–ø–∏—à–∏:
   - –∫–∞–∫ —Ç—ã –ø–æ–Ω—è–ª —Ç–µ–∫—É—â—É—é —Å—Ö–µ–º—É –¥–∞–Ω–Ω—ã—Ö (–º–æ–¥–µ–ª–∏ –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤, —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–π –∏ –∏—Å—Ç–æ—Ä–∏–∏);
   - –≥–¥–µ –∏–º–µ–Ω–Ω–æ –≤–æ–∑–Ω–∏–∫–∞–ª–∏ –¥—É–±–ª–∏ –∏ –∑–∞ —Å—á—ë—Ç –∫–∞–∫–æ–π –ª–æ–≥–∏–∫–∏;
   - –∫–∞–∫ —Ç–≤–æ–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É—é—Ç:
     - –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –¥—É–±–ª–µ–π,
     - –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –∏–Ω—Ç–µ—Ä–≤–∞–ª—ã,
     - –∫–æ—Ä—Ä–µ–∫—Ç–Ω—É—é ¬´–º–µ—Å—è—á–Ω—É—é —Ñ–∞–∑—É¬ª,
     - –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ –∫–Ω–æ–ø–∫–∏ ¬´–ù–µ –ø–æ–≤—Ç–æ—Ä–∏–ª¬ª (–ø–µ—Ä–µ–Ω–æ—Å –Ω–∞ –∑–∞–≤—Ç—Ä–∞ + –æ—Ç–∫–∞—Ç —Å—Ç–∞–¥–∏–∏).

4) –í –æ—Ç–≤–µ—Ç–µ –ø–æ–∫–∞–∂–∏:
   - –æ–±–Ω–æ–≤–ª—ë–Ω–Ω—ã–π `app/utils/ebbinghaus.py`;
   - –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ `schedule_service.py` –∏ `scheduler.py`;
   - –º–µ—Å—Ç–æ —Å –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–º —Ç–µ–∫—Å—Ç–æ–º —Å–æ–æ–±—â–µ–Ω–∏—è ¬´–Ω–µ—É—Å–ø–µ—à–Ω–æ–≥–æ¬ª –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏—è;
   - –Ω–æ–≤—ã–π —Ä–æ—É—Ç debug-—ç–Ω–¥–ø–æ–∏–Ω—Ç–∞ –≤ `main.py` (–∏–ª–∏ –æ—Ç–¥–µ–ª—å–Ω–æ–º –º–æ–¥—É–ª–µ —Ä–æ—É—Ç–æ–≤);
   - –ø–æ–ª–Ω—ã–µ —Ñ–∞–π–ª—ã —Å –Ω–æ–≤—ã–º–∏/–æ–±–Ω–æ–≤–ª—ë–Ω–Ω—ã–º–∏ —Ç–µ—Å—Ç–∞–º–∏.

–°–Ω–∞—á–∞–ª–∞ –∑–∞–ø—Ä–æ—Å–∏ —É –º–µ–Ω—è —Ñ–∞–π–ª—ã:
- `app/utils/ebbinghaus.py`
- `app/services/schedule_service.py`
- `app/scheduler.py`
- `app/bot.py`
- `app/main.py`
- `app/database/models.py`
- `tests/test_utils.py`
- `tests/test_services.py`
- `tests/test_bot.py`

–ü–æ—Å–ª–µ —ç—Ç–æ–≥–æ:
1) –°–æ—Å—Ç–∞–≤—å –∫—Ä–∞—Ç–∫–∏–π –ø–ª–∞–Ω —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞.
2) –ü–æ—Ç–æ–º –ø–æ–∫–∞–∂–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –ø–∞—Ç—á–∏ (–æ–±–Ω–æ–≤–ª—ë–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã) –∏ –Ω–æ–≤—ã–µ unit-—Ç–µ—Å—Ç—ã.
